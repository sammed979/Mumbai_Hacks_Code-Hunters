<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cattle Health Check</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { text-align: center; margin-bottom: 30px; }
        h1 { color: #2c3e50; margin-bottom: 10px; }
        .section { margin-bottom: 30px; }
        .section-title { font-size: 1.3rem; color: #2c3e50; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .checkbox-item { background: #f8f9fa; padding: 12px; border-radius: 8px; border: 2px solid #e0e0e0; cursor: pointer; transition: all 0.3s; }
        .checkbox-item:hover { border-color: #667eea; background: #f0f4ff; }
        .checkbox-item input[type="checkbox"] { margin-right: 10px; width: 18px; height: 18px; cursor: pointer; }
        .checkbox-item label { cursor: pointer; font-size: 15px; color: #333; }
        .radio-group { display: flex; gap: 15px; flex-wrap: wrap; }
        .radio-item { background: #f8f9fa; padding: 10px 20px; border-radius: 8px; border: 2px solid #e0e0e0; cursor: pointer; }
        .radio-item input[type="radio"] { margin-right: 8px; }
        .radio-item:has(input:checked) { border-color: #667eea; background: #f0f4ff; }
        .text-input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; margin-top: 10px; }
        .submit-btn { width: 100%; padding: 15px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .submit-btn:hover { background: #5568d3; }
        .result-box { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 5px solid #667eea; display: none; }
        .result-title { font-size: 1.2rem; color: #2c3e50; margin-bottom: 10px; font-weight: bold; }
        .risk-high { color: #e74c3c; font-weight: bold; }
        .risk-medium { color: #f39c12; font-weight: bold; }
        .risk-low { color: #27ae60; font-weight: bold; }
        .back-btn { display: inline-block; padding: 10px 20px; background: #95a5a6; color: white; text-decoration: none; border-radius: 8px; margin-bottom: 20px; }
        .back-btn:hover { background: #7f8c8d; }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-btn">‚Üê Back to Home</a>
        
        <div class="header">
            <h1>ü©∫ Cattle Health Check</h1>
            <p>Select symptoms to get health assessment</p>
        </div>

        <form id="healthForm">
            <div class="section">
                <div class="section-title">Upload Image (Optional)</div>
                <input type="file" id="imageUpload" accept="image/*" class="text-input" style="padding: 10px;">
                <div id="imagePreview" style="margin-top: 10px; text-align: center;"></div>
            </div>

            <div class="section">
                <div class="section-title">Describe Problem (Text)</div>
                <textarea class="text-input" id="text_description" placeholder="Example: My cow has fever and not eating for 2 days, also coughing..." rows="3"></textarea>
            </div>

            <div class="section">
                <div class="section-title">General Symptoms</div>
                <div class="checkbox-grid">
                    <div class="checkbox-item">
                        <input type="checkbox" id="fever" name="fever" value="yes">
                        <label for="fever">üå°Ô∏è Fever</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="weakness" name="weakness" value="yes">
                        <label for="weakness">üòî Weakness</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="cough" name="cough" value="yes">
                        <label for="cough">ü§ß Cough</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="nasal_discharge" name="nasal_discharge" value="yes">
                        <label for="nasal_discharge">üëÉ Nasal Discharge</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="eye_discharge" name="eye_discharge" value="yes">
                        <label for="eye_discharge">üëÅÔ∏è Eye Discharge</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="difficulty_breathing" name="difficulty_breathing" value="yes">
                        <label for="difficulty_breathing">üí® Difficulty Breathing</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Appetite & Digestion</div>
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="appetite_normal" name="appetite" value="normal">
                        <label for="appetite_normal">Normal Eating</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="appetite_low" name="appetite" value="low">
                        <label for="appetite_low">Eating Less</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="appetite_stopped" name="appetite" value="stopped">
                        <label for="appetite_stopped">Not Eating</label>
                    </div>
                </div>
                <div class="checkbox-grid" style="margin-top: 15px;">
                    <div class="checkbox-item">
                        <input type="checkbox" id="diarrhea" name="digestive_issue" value="yes">
                        <label for="diarrhea">üí© Diarrhea</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bloat" name="bloat" value="yes">
                        <label for="bloat">üéà Bloating</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="vomiting" name="vomiting" value="yes">
                        <label for="vomiting">ü§Æ Vomiting</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">Skin & Body</div>
                <div class="checkbox-grid">
                    <div class="checkbox-item">
                        <input type="checkbox" id="skin_lesions" name="skin_lesions" value="yes">
                        <label for="skin_lesions">üî¥ Skin Lesions</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="swelling" name="swelling" value="yes">
                        <label for="swelling">üîµ Swelling</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="lameness" name="lameness" value="yes">
                        <label for="lameness">ü¶µ Lameness</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="hair_loss" name="hair_loss" value="yes">
                        <label for="hair_loss">ü™Æ Hair Loss</label>
                    </div>
                </div>
            </div>



            <button type="submit" class="submit-btn">üîç Check Health Status</button>
        </form>

        <div id="resultBox" class="result-box"></div>
    </div>

    <script>
        document.getElementById('imageUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" style="max-width: 300px; border-radius: 8px;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('healthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            
            // Add image if uploaded
            const imageFile = document.getElementById('imageUpload').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }
            
            // Add text description
            formData.append('text_description', document.getElementById('text_description').value);
            
            // Add checkbox symptoms
            const checkboxData = new FormData(e.target);
            formData.append('fever', checkboxData.get('fever') || 'no');
            formData.append('weakness', checkboxData.get('weakness') || 'no');
            formData.append('cough', checkboxData.get('cough') || 'no');
            formData.append('nasal_discharge', checkboxData.get('nasal_discharge') || 'no');
            formData.append('appetite', checkboxData.get('appetite') || 'unknown');
            formData.append('digestive_issue', checkboxData.get('digestive_issue') || 'no');

            try {
                const response = await fetch('/api/health/check', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                displayResult(result);
            } catch (error) {
                console.error('Error:', error);
                alert('Error checking health. Please try again.');
            }
        });

        function displayResult(result) {
            const resultBox = document.getElementById('resultBox');
            const prediction = result.prediction || result.disease_prediction;
            
            let riskClass = 'risk-low';
            if (prediction.risk_level === 'High') riskClass = 'risk-high';
            else if (prediction.risk_level === 'Medium') riskClass = 'risk-medium';

            let html = `
                <div class="result-title">Health Assessment Result</div>
                ${result.analysis_type ? `<p style="color: #666; font-size: 14px; margin-bottom: 10px;">Analysis: ${result.analysis_type}</p>` : ''}
                <p><strong>Possible Issue:</strong> ${prediction.disease}</p>
                <p><strong>Risk Level:</strong> <span class="${riskClass}">${prediction.risk_level}</span></p>
                <p><strong>Reason:</strong> ${prediction.reason}</p>
                
                <div style="margin-top: 15px;">
                    <strong>What you can do now:</strong>
                    <ul style="margin-left: 20px; margin-top: 5px;">
                        ${prediction.care_steps.map(step => `<li>${step}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;">
                    <strong>‚ö†Ô∏è When to call a vet:</strong> ${prediction.vet_urgency}
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: #f8d7da; border-radius: 8px; font-size: 14px; color: #721c24;">
                    <strong>Important:</strong> This is only a possible assessment, not a confirmed diagnosis. Consult a qualified veterinarian for treatment.
                </div>
            `;

            resultBox.innerHTML = html;
            resultBox.style.display = 'block';
            resultBox.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
